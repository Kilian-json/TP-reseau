I. Le setup

☀️ Prouvez que...

une machine du LAN1 peut joindre internet (ping un nom de domaine) :
```
[kilian@dhcp ~]$ ping google.com
PING google.com (172.217.18.206) 56(84) bytes of data.
64 bytes from par10s38-in-f14.1e100.net (172.217.18.206): icmp_seq=1 ttl=115 time=21.2 ms
64 bytes from par10s38-in-f14.1e100.net (172.217.18.206): icmp_seq=2 ttl=115 time=18.8 ms
64 bytes from par10s38-in-f14.1e100.net (172.217.18.206): icmp_seq=3 ttl=115 time=18.9 ms
```

une machine du LAN2 peut joindre internet (ping nom de domaine) :
```
[kilian@dns ~]$ ping google.com
PING google.com (142.250.201.46) 56(84) bytes of data.
64 bytes from mrs08s20-in-f14.1e100.net (142.250.201.46): icmp_seq=1 ttl=111 time=20.0 ms
64 bytes from mrs08s20-in-f14.1e100.net (142.250.201.46): icmp_seq=2 ttl=111 time=18.8 ms
```

une machine du LAN1 peut joindre une machine du LAN2 (ping une adresse IP) :
```
[kilian@dhcp ~]$ ping 10.6.2.12
PING 10.6.2.12 (10.6.2.12) 56(84) bytes of data.
64 bytes from 10.6.2.12: icmp_seq=1 ttl=63 time=11.2 ms
64 bytes from 10.6.2.12: icmp_seq=2 ttl=63 time=1.92 ms
```
2. Client
   
☀️ Prouvez que...

le client a bien récupéré une adresse IP en DHCP
```
[kilian@client1 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:ee:35:01 brd ff:ff:ff:ff:ff:ff
   ☀️ inet 10.6.1.37/24 brd 10.6.1.255 scope global ☀️dynamic noprefixroute enp0s3
       valid_lft 547sec preferred_lft 547sec
    inet6 fe80::a00:27ff:feee:3501/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
```

vous avez bien 1.1.1.1 en DNS
```
[kilian@client1 ~]$ cat /etc/resolv.conf
# Generated by NetworkManager
nameserver 1.1.1.1
```

vous avez bien la bonne passerelle indiquée
```
[kilian@client1 ~]$ ip r s
default via 10.6.1.254 dev enp0s3 proto dhcp src 10.6.1.37 metric 100
10.6.1.0/24 dev enp0s3 proto kernel scope link src 10.6.1.37 metric 100
```

III. LAN serveurzzzz

1. Serveur Web

☀️ Déterminer sur quel port écoute le serveur NGINX
```
[kilian@web ~]$ sudo ss -lnpt | grep 80
LISTEN 0      511          0.0.0.0:80        0.0.0.0:*    users:(("nginx",pid=1512,fd=6),("nginx",pid=1511,fd=6))
LISTEN 0      511             [::]:80           [::]:*    users:(("nginx",pid=1512,fd=7),("nginx",pid=1511,fd=7))
```

☀️ Ouvrir ce port dans le firewall
```
[kilian@web ~]$ sudo firewall-cmd --permanent --add-port=80/tcp
success
```

☀️ Visitez le site web !
```
[kilian@client1 ~]$ curl http://10.6.2.11
<!doctype html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
```

III. 2. Serveur DNS
☀️ Déterminer sur quel(s) port(s) écoute le service BIND9
```
[kilian@dns ~]$ sudo ss -lnpt | grep 53
LISTEN 0      10         127.0.0.1:53        0.0.0.0:*    users:(("named",pid=2014,fd=22))
LISTEN 0      10         10.6.2.12:53        0.0.0.0:*    users:(("named",pid=2014,fd=25))
LISTEN 0      10             [::1]:53           [::]:*    users:(("named",pid=2014,fd=27))

[kilian@dns ~]$ sudo ss -lnpu | grep 53
UNCONN 0      0          10.6.2.12:53        0.0.0.0:*    users:(("named",pid=2014,fd=24))
UNCONN 0      0          127.0.0.1:53        0.0.0.0:*    users:(("named",pid=2014,fd=21))
UNCONN 0      0              [::1]:53           [::]:*    users:(("named",pid=2014,fd=26))
```

☀️ Ouvrir ce(s) port(s) dans le firewall
```
[kilian@dns ~]$ sudo firewall-cmd --permanent --add-port=53/tcp
success
[kilian@dns ~]$ sudo firewall-cmd --reload
success
```

5. Tests manuels
☀️ Effectuez des requêtes DNS manuellement depuis le serveur DNS lui-même dans un premier temps
```
[kilian@dns ~]$ dig web.tp6.b1 @10.6.2.12

; <<>> DiG 9.16.23-RH <<>> web.tp6.b1 @10.6.2.12
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 4333
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: a2c80f50c2e5941a0100000067166a3987803ae69b58c239 (good)
;; QUESTION SECTION:
;web.tp6.b1.                    IN      A

;; ANSWER SECTION:
web.tp6.b1.             86400   IN      A       10.6.2.11

;; Query time: 0 msec
;; SERVER: 10.6.2.12#53(10.6.2.12)
;; WHEN: Mon Oct 21 16:50:33 CEST 2024
;; MSG SIZE  rcvd: 83

[kilian@dns ~]$ dig dns.tp6.b1 @10.6.2.12

; <<>> DiG 9.16.23-RH <<>> dns.tp6.b1 @10.6.2.12
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 44998
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: b6a87119e6068b270100000067166a8ea59ad98667404ecb (good)
;; QUESTION SECTION:
;dns.tp6.b1.                    IN      A

;; ANSWER SECTION:
dns.tp6.b1.             86400   IN      A       10.6.2.12

;; Query time: 0 msec
;; SERVER: 10.6.2.12#53(10.6.2.12)
;; WHEN: Mon Oct 21 16:51:58 CEST 2024
;; MSG SIZE  rcvd: 83

[kilian@dns ~]$ dig ynov.com @10.6.2.12

; <<>> DiG 9.16.23-RH <<>> ynov.com @10.6.2.12
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 53936
;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: f6622ea8955cc2910100000067166abef58a421079ca4639 (good)
;; QUESTION SECTION:
;ynov.com.                      IN      A

;; ANSWER SECTION:
ynov.com.               300     IN      A       172.67.74.226
ynov.com.               300     IN      A       104.26.11.233
ynov.com.               300     IN      A       104.26.10.233

;; Query time: 697 msec
;; SERVER: 10.6.2.12#53(10.6.2.12)
;; WHEN: Mon Oct 21 16:52:46 CEST 2024
;; MSG SIZE  rcvd: 113

[kilian@dns ~]$ dig -x 10.6.2.11 @10.6.2.12

; <<>> DiG 9.16.23-RH <<>> -x 10.6.2.11 @10.6.2.12
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 22059
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 63595fa1e4ddd6960100000067166af1cc34c4a2f1ebfd98 (good)
;; QUESTION SECTION:
;11.2.6.10.in-addr.arpa.                IN      PTR

;; ANSWER SECTION:
11.2.6.10.in-addr.arpa. 86400   IN      PTR     web.tp6.b1.

;; Query time: 0 msec
;; SERVER: 10.6.2.12#53(10.6.2.12)
;; WHEN: Mon Oct 21 16:53:37 CEST 2024
;; MSG SIZE  rcvd: 103

[kilian@dns ~]$ dig -x 10.6.2.12 @10.6.2.12

; <<>> DiG 9.16.23-RH <<>> -x 10.6.2.12 @10.6.2.12
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 30397
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: a945aaf8b9891d0b0100000067166b0fbfbe5e88be857fbd (good)
;; QUESTION SECTION:
;12.2.6.10.in-addr.arpa.                IN      PTR

;; ANSWER SECTION:
12.2.6.10.in-addr.arpa. 86400   IN      PTR     dns.tp6.b1.

;; Query time: 0 msec
;; SERVER: 10.6.2.12#53(10.6.2.12)
;; WHEN: Mon Oct 21 16:54:07 CEST 2024
;; MSG SIZE  rcvd: 103
```

☀️ Effectuez une requête DNS manuellement depuis client1.tp6.b1
```
[kilian@client1 ~]$ dig web.tp6.b1 @10.6.2.12

; <<>> DiG 9.16.23-RH <<>> web.tp6.b1 @10.6.2.12
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 29288
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 561e75cf85d86b440100000067166bbc7ae54142da3cebf0 (good)
;; QUESTION SECTION:
;web.tp6.b1.                    IN      A

;; ANSWER SECTION:
web.tp6.b1.             86400   IN      A       10.6.2.11

;; Query time: 4 msec
;; SERVER: 10.6.2.12#53(10.6.2.12)
;; WHEN: Mon Oct 21 16:57:00 CEST 2024
;; MSG SIZE  rcvd: 83
```

☀️ Capturez une requête DNS et la réponse de votre serveur
    voir le document RequêteDNS

☀️ Créez un nouveau client client2.tp6.b1 vitefé
```
[kilian@client2 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:67:63:8b brd ff:ff:ff:ff:ff:ff
    inet 10.6.1.38/24 brd 10.6.1.255 scope global dynamic noprefixroute enp0s3
       valid_lft 427sec preferred_lft 427sec
    inet6 fe80::a00:27ff:fe67:638b/64 scope link noprefixroute
       valid_lft forever preferred_lft forever

[kilian@client2 ~]$ cat /etc/resolv.conf
# Generated by NetworkManager
nameserver 10.6.2.12

nameserver 10.6.2.12
[kilian@client2 ~]$ curl http://web.tp6.b1
<!doctype html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
```
